{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "OBS Scheduler Configuration",
  "type": "object",
  "required": [
    "events"
  ],
  "properties": {
    "events": {
      "title": "Events",
      "description": "A list of events for triggering an action within OBS.",
      "type": "array",
      "format": "tabs",
      "items": {
        "title": "Event",
        "headerTemplate": "{{ self.name }}",
        "description": "A scheduled event for triggering a set action in OBS.",
        "type": "object",
        "required": [
          "schedule_type",
          "action"
        ],
        "properties": {
          "name": {
            "title": "Name",
            "description": "An optional name for the event.",
            "propertyOrder": 1,
            "type": "string"
          },
          "enabled": {
            "title": "Enabled",
            "description": "Whether or not this event should be considered \"active\".",
            "propertyOrder": 2,
            "type": "boolean",
            "default": true,
            "format": "checkbox"
          },
          "schedule_type": {
            "title": "Schedule Type",
            "propertyOrder": 3,
            "$ref": "#/definitions/ScheduleType"
          },
          "date": {
            "title": "Date",
            "description": "A date/time for when the action should trigger.",
            "propertyOrder": 4,
            "type": "string",
            "format": "datetime-local",
            "options": {
              "dependencies": {
                "schedule_type": "date"
              }
            }
          },
          "schedule": {
            "title": "Schedule",
            "description": "A schedule for a recurring event in crontab format.",
            "propertyOrder": 4,
            "type": "string",
            "format": "crontab",
            "pattern": "^((((\\d+,)+\\d+|(\\d+(\\/|-|#)\\d+)|\\d+L?|\\*(\\/\\d+)?|L(-\\d+)?|\\?|[A-Z]{3}(-[A-Z]{3})?) ?){5,7})|(@(annually|yearly|monthly|weekly|daily|hourly|reboot))|(@every (\\d+(ns|us|Âµs|ms|s|m|h))+)$",
            "options": {
              "dependencies": {
                "schedule_type": "recurring"
              }
            }
          },
          "action": {
            "title": "Action",
            "propertyOrder": 5,
            "$ref": "#/definitions/EventAction"
          },
          "switcher_message": {
            "title": "Advanced Scene Switcher Message",
            "description": "A message to send to Advanced Scene Switcher.",
            "type": "string",
            "options": {
              "dependencies": {
                "action": "advanced_scene_switcher"
              }
            }
          },
          "ws_request": {
            "title": "OBS Websocket Message",
            "$ref": "#/definitions/OBSWSRequest"
          }
        },
        "allOf": [
          {
            "if": {
              "properties": {
                "schedule_type": {
                  "const": "date"
                }
              }
            },
            "then": {
              "required": [
                "date"
              ]
            }
          },
          {
            "if": {
              "properties": {
                "schedule_type": {
                  "const": "recurring"
                }
              }
            },
            "then": {
              "required": [
                "schedule"
              ]
            }
          },
          {
            "if": {
              "properties": {
                "action": {
                  "const": "advanced_scene_switcher"
                }
              }
            },
            "then": {
              "required": [
                "switcher_message"
              ]
            }
          },
          {
            "if": {
              "properties": {
                "action": {
                  "const": "obs_ws"
                }
              }
            },
            "then": {
              "required": [
                "ws_request"
              ]
            }
          }
        ],
        "options": {
          "switcher": false
        }
      }
    }
  },
  "additionalProperties": false,
  "definitions": {
    "ScheduleType": {
      "description": "The type of schedule for an event.",
      "type": "string",
      "enum": [
        "date",
        "recurring"
      ],
      "options": {
        "enum_titles": [
          "Specific Date/Time",
          "Recurring Event"
        ]
      }
    },
    "EventAction": {
      "description": "An action to trigger in OBS.",
      "type": "string",
      "enum": [
        "start_stream",
        "stop_stream",
        "start_recording",
        "pause_recording",
        "stop_recording",
        "advanced_scene_switcher",
        "obs_ws"
      ],
      "options": {
        "enum_titles": [
          "Start Stream",
          "Stop Stream",
          "Start Recording",
          "Pause Recording",
          "Stop Recording",
          "Advanced Scene Switcher",
          "Raw Websocket"
        ]
      }
    },
    "OBSWSRequest": {
      "description": "A message to send to OBS as a raw Websocket message.",
      "type": "object",
      "required": [
        "type",
        "data"
      ],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string"
        },
        "type": {
          "type": "string"
        },
        "data": {
          "type": "object"
        }
      },
      "options": {
        "dependencies": {
          "action": "obs_ws"
        }
      }
    }
  }
}
